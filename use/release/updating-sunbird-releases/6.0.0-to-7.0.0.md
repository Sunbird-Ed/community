# 6.0.0 to 7.0.0

### Overview <a href="#user-content-overview" id="user-content-overview"></a>

This page details out the jobs required to be run as part of the upgrade of Sunbird Ed from release 6.0.0 to release 7.0.0. Use the following table to understand the Jenkins jobs that need to be executed in order to successfully complete the upgrade. Any jenkins job configuration or pre-requisites mentioned under manual configuration section needs to be done first before running any of the mentioned jobs. The order of the jobs should also be run as shown below.

1\. Login to Jenkins VM

`su jenkins`

Replace the config.xml for the following mentioned Jenkins path

| Jenkins Jobs                          | Path of Jenkins Server                                                | Update Jenkins job URL                                                                                                                                                                                                                                                                                                       |
| ------------------------------------- | --------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Build/Core/UserOrg                    | /var/lib/jenkins/jobs/Build/jobs/Core/jobs/UserOrg                    | [https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Build/jobs/Core/jobs/UserOrg/config.xml](https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Build/jobs/Core/jobs/UserOrg/config.xml)                                                         |
| Deploy/Kubernetes/UserOrg             | /var/lib/jenkins/jobs/Deploy/jobs/Kubernetes/jobs/UserOrg             | [https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Deploy/jobs/dev/jobs/Kubernetes/jobs/UserOrg/config.xml](https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Deploy/jobs/dev/jobs/Kubernetes/jobs/UserOrg/config.xml)                         |
| Deploy/Kubernetes/InquiryUploadSchema | /var/lib/jenkins/jobs/Deploy/jobs/Kubernetes/jobs/InquiryUploadSchema | [https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Deploy/jobs/dev/jobs/Kubernetes/jobs/InquiryUploadSchema/config.xml](https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Deploy/jobs/dev/jobs/Kubernetes/jobs/InquiryUploadSchema/config.xml) |
| Build/Core/Search                     | /var/lib/jenkins/jobs/Build/jobs/Core/jobs/UserOrg                    | [https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Build/jobs/Core/jobs/Search/config.xml](https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Build/jobs/Core/jobs/Search/config.xml)                                                           |
| Build/Core/Knowlgmw                   | /var/lib/jenkins/jobs/Build/jobs/Core/jobs/UserOrg                    | [https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Build/jobs/Core/jobs/KnowledgeMW/config.xml](https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Build/jobs/Core/jobs/KnowledgeMW/config.xml)                                                 |
| Build/Core/Taxonomy                   | /var/lib/jenkins/jobs/Build/jobs/Core/jobs/Taxonomy                   | [https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Deploy/jobs/dev/jobs/Kubernetes/jobs/Taxonomy/config.xml](https://github.com/project-sunbird/sunbird-devops/blob/release-7.0.0/deploy/jenkins/jobs/Deploy/jobs/dev/jobs/Kubernetes/jobs/Taxonomy/config.xml)                       |

### Adding the new variables

Update the following variables in sunbird-devops private repo according to your environment

`cd ansible/inventory/dev/`KnowledgePlatform`/secrets.yaml`

<pre class="language-bash"><code class="lang-bash"><strong>core_vault_sunbird_keycloak_user_federation_provider_id: fd241dce-4ZZ9-47e1-97cf-1c7de7a44216 #releated to keycloak
</strong></code></pre>

`cd ansible/inventory/dev/DataPipeline/common.yaml`

```bash
druid_storage_type: azure
```

### **Build and Deploy for SunbirdED**

#### **SunbirdED:**

| Service     | Build job                               | Build tag           | Comments | Deploy Job                               | Deploy tag    |
| ----------- | --------------------------------------- | ------------------- | -------- | ---------------------------------------- | ------------- |
| Portal      | <p>Build/Core/Player<br></p>            | release-7.0.0\_RC23 |          | Deploy/Kubernetes/Player                 | release-7.0.0 |
| ML Services | Build/managed-learn/ml-projects-service | release-7.0.0\_RC2  |          | Deploy/managed-learn/ml-projects-service | release-7.0.0 |
|             | Build/managed-learn/ml-core-service     | release-7.0.0\_RC4  |          | Deploy/managed-learn/ml-core-service     | release-7.0.0 |
|             | Build/managed-learn/ml-reports-service  | release-7.0.0\_RC1  |          | Deploy/managed-learn/ml-reports-service  | release-7.0.0 |
|             | Build/managed-learn/ml-survey-service   | release-7.0.0\_RC3  |          | Deploy/managed-learn/ml-survey-service   | release-7.0.0 |
|             |                                         |                     |          |                                          |               |

#### Sunbird Lern:

<table data-full-width="false"><thead><tr><th>Service/Component</th><th>Build job</th><th>Build tag</th><th>Deploy Job</th><th>Deploy tag</th><th>Comments</th></tr></thead><tbody><tr><td>OnboardAPIs</td><td></td><td></td><td>Deploy/Kubernetes/OnboardAPIs</td><td>release-7.0.0</td><td></td></tr><tr><td>Cassandra Migration</td><td>Build/Core/Cassandra</td><td>release-7.0.0_RC3</td><td>Deploy/Kubernetes/Cassandra</td><td>release-7.0.0</td><td><p>Select the sunbird in cassandra_keyspace_to_migrate while deploying</p><p>script_repo_branch_or_tag: release-7.0.0_RC3</p></td></tr><tr><td>Kafka Setup</td><td></td><td></td><td>Deploy/Lern/KafkaSetup</td><td>release-7.0.0_RC6</td><td></td></tr><tr><td>ES mapping</td><td></td><td></td><td>Provision/Core/ESMapping</td><td>release-7.0.0</td><td>Updates the es mapping to accept dynamic framework category to index user data</td></tr><tr><td>Data pipeline</td><td>Build/Lern/FlinkJobs</td><td>github_release_tag:release-7.0.0_RC7,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/Lern/FlinkJobs</td><td>release-7.0.0_RC7</td><td>Add user-deletion-cleanup and ml-user-delete into job list and deploy it.</td></tr><tr><td>Lern data products</td><td>Build/Lern/LernDataProducts</td><td>github_release_tag:release-7.0.0_RC7,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/Lern/LernDataProducts</td><td>release-7.0.0_RC7</td><td></td></tr><tr><td>Group Service</td><td>Build/Core/Groups</td><td>github_release_tag:release-7.0.0_RC2,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.0</td><td>Deploy/Kubernetes/Groups</td><td>release-7.0.0</td><td></td></tr><tr><td>User&#x26;Org Service</td><td>Build/Core/UserOrg</td><td>github_release_tag:release-7.0.0_RC5,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.0CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/Kubernetes/Learner</td><td>release-7.0.0</td><td></td></tr><tr><td>Batch Service</td><td>Build/Core/Lms</td><td>github_release_tag:release-7.0.0_RC2,,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.0CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/Kubernetes/Lms</td><td>release-7.0.0</td><td></td></tr><tr><td>Discussions Middleware</td><td>Build/Core/DiscussionsMiddleware</td><td>release-7.0.0_RC1</td><td>Deploy/Kubernetes/DiscussionsMW</td><td>release-7.0.0</td><td></td></tr></tbody></table>

### Data Security Policy setup

**Configurations to be done by System admin:**

1. Setup **default** 'Data Security Policy' settings using tenant preference API.&#x20;

```
curl --location --request PATCH '{{host}}/api/org/v2/preferences/update' \
--header 'x-authenticated-user-token: {{user_authentication_token}}' \
--header 'Authorization: Bearer {{kong_api_token}}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "request": {
        "orgId": "default",
        "key": "dataSecurityPolicy",
        "data": {
            "level": "PLAIN_DATASET",
            "dataEncrypted": "No",
            "comments": "Data is not encrypted",
            "job": {
                    "userinfo-exhaust": {
                        "level": "PASSWORD_PROTECTED_DATASET",
                        "dataEncrypted": "No",
                        "comments": "Password protected file."
                    },
                    "program-user-exhaust": {
                        "level": "PASSWORD_PROTECTED_DATASET",
                        "dataEncrypted": "No",
                        "comments": "Password protected file."
                    }
                },
            "securityLevels": {
                "PLAIN_DATASET": "Data is present in plain text/zip. Generally applicable to open datasets.",
                "PASSWORD_PROTECTED_DATASET": "Password protected zip file. Generally applicable to non PII data sets but can contain sensitive information which may not be considered open.",
                "TEXT_KEY_ENCRYPTED_DATASET": "Data encrypted with a user provided encryption key. Generally applicable to non PII data but can contain sensitive information which may not be considered open.",
                "PUBLIC_KEY_ENCRYPTED_DATASET": "Data encrypted via an org provided public/private key. Generally applicable to all PII data exhaust."
            }
        }
    }
}'
```

#### Sunbird Obsrv

<table data-full-width="false"><thead><tr><th>Service/Component</th><th>Build job</th><th>Build tag</th><th>Deploy Job</th><th>Deploy tag</th><th>Comments</th></tr></thead><tbody><tr><td>Data pipeline</td><td>Build/DataPipeline/AnalyticsCore</td><td>github_release_tag:release-5.1.3_RC4,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.0</td><td>Deploy/DataPipeline/AnalyticsCore</td><td>release-5.2.0_RC6</td><td></td></tr><tr><td>Core Data products</td><td>Build/DataPipeline/CoreDataProducts</td><td>github_release_tag:release-5.1.3_RC5,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.0</td><td>Deploy/DataPipeline/CoreDataProducts</td><td>release-5.2.0_RC6</td><td></td></tr><tr><td>Analytics Service</td><td>Build/Core/Analytics</td><td>release-5.1.3_RC1</td><td>Deploy/Kubernetes/Analytics</td><td>release-5.2.0_RC6</td><td></td></tr><tr><td>Spark Provision</td><td></td><td></td><td>Provision/DataPipeline/AnalyticsSpark</td><td>release-5.2.0_RC6</td><td></td></tr><tr><td>Secor</td><td></td><td></td><td>Deploy/DataPipeline/Secor</td><td>release-5.2.0_RC6</td><td></td></tr><tr><td>FlinkJobs</td><td>Build/DataPipeline/FlinkPipelineJobs</td><td>release-5.2.0_RC6</td><td>Deploy/DataPipeline/FlinkPipelineJobs</td><td>release-5.2.0_RC6</td><td></td></tr></tbody></table>

#### **Sunbird-Knowlg**

<table data-full-width="false"><thead><tr><th width="164">Service/Component</th><th width="144">Build job</th><th width="132">Build tag</th><th>Deploy Job</th><th>Deploy tag</th><th>Comments</th></tr></thead><tbody><tr><td>Knowledge-platform-jobs</td><td>Build/KnowledgePlatform/FlinkJobs</td><td>github_release_tag:release-5.7.0_RC3,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk_2.12,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/KnowledgePlatform/FlinkJobs</td><td>release-5.7.0_RC4</td><td></td></tr><tr><td>content-service</td><td>Build/Core/Content</td><td>github_release_tag:release-5.7.0_RC11,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/Kubernetes/Content</td><td>release-7.0.0</td><td></td></tr><tr><td>Plugins</td><td>Build/Plugins/ContentPlugins</td><td>release-5.2.1_RC4</td><td>Deploy/Plugins/ContentPlugins</td><td>release-7.0.0</td><td></td></tr><tr><td>Plugins</td><td>Build/Plugins/ContentEditor</td><td>release-5.2.1_RC4</td><td>Deploy/Plugins/ContentEditor</td><td>release-7.0.0</td><td></td></tr><tr><td>Search </td><td>Build/Core/Search</td><td>release-5.7.0_RC8,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/Kubernetes/Search</td><td>release-7.0.0</td><td></td></tr><tr><td>Taxonomy</td><td>Build/Core/Taxonomy</td><td>release-5.7.0_RC7,CLOUD_STORE_GROUP_ID:org.sunbird,CLOUD_STORE_ARTIFACT_ID:cloud-store-sdk,CLOUD_STORE_VERSION:1.4.6</td><td>Deploy/Kubernetes/Taxonomy</td><td>release-7.0.0</td><td></td></tr><tr><td>Schema Upload</td><td></td><td></td><td>Deploy/Kubernetes/UploadSchema</td><td>release-5.7.0_RC9</td><td></td></tr></tbody></table>

#### **Sunbird-InQuiry**

<table data-full-width="false"><thead><tr><th>Service/Component</th><th>Build job</th><th>Build tag</th><th>Deploy Job</th><th>Deploy tag</th><th>Comments</th></tr></thead><tbody><tr><td>Assessment</td><td>Build/Core/Assessment</td><td>inquiry_release_tag:release-7.0.0_RC2,core_release_tag:release-5.6.0_RC3</td><td>Deploy/Kubernetes/Assessment</td><td>release-7.0.0</td><td></td></tr><tr><td>InQuiryFlink Job</td><td>Build/KnowledgePlatform/InquiryFlinkJob</td><td>release-7.0.0_RC7</td><td>Deploy/KnowledgePlatform/InquiryFlinkJob</td><td>release-7.0.0_RC7</td><td>A New Flink Job user-pii-data-updater is added.</td></tr><tr><td>InquiryUploadSchema</td><td></td><td></td><td>Deploy/job/dev/job/Kubernetes/job/InquiryUploadSchema/</td><td>Schema Should be Uploaded For Question &#x26; QuestionSet using release-7.0.0_RC2</td><td></td></tr><tr><td>InquiryKafkaSetup</td><td></td><td></td><td>Deploy/job/dev/job/KnowledgePlatform/job/InquiryKafkaSetup/</td><td>release-7.0.0_RC4</td><td>A new kafka topic delete.user has to be created for user-pii-data-updater flink job.</td></tr></tbody></table>



